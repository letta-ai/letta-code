name: Auto-Generate Documentation

on:
  push:
    branches: [main]
    paths:
      - 'src/**'
      - 'lib/**'
  workflow_dispatch:

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Generate API Documentation
        id: docs
        uses: letta-ai/letta-code@v1
        with:
          api-key: ${{ secrets.LETTA_API_KEY }}
          working-directory: './docs'
          prompt: |
            Generate comprehensive API documentation:
            1. Create/update API.md with all public APIs
            2. Include function signatures, parameters, return types
            3. Add usage examples for each API
            4. Document error cases
            5. Include code examples
            
            Maintain existing documentation structure.
          cli-args: >-
            --model claude-sonnet-4.5
            --tools Read,Write,Grep,Glob
            --permission-mode acceptEdits
            --output-format json

      - name: Commit documentation
        if: steps.docs.outputs.exit-code == '0'
        run: |
          git config user.name "Letta Code"
          git config user.email "noreply@letta.com"
          
          if [[ -n $(git status -s) ]]; then
            git add docs/
            git commit -m "ğŸ“ Auto-update API documentation

          ğŸ¦¾ Generated with Letta Code"
            git push
          else
            echo "No documentation changes to commit"
          fi
